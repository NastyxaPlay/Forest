{"version":3,"file":"BridgeService.js","sourceRoot":"","sources":["../../src/services/BridgeService.ts"],"names":[],"mappings":"AAAA,OAAO,MAAM,MAAM,sBAAsB,CAAC;AAC1C,OAAO,EAAE,SAAS,EAAE,MAAM,gBAAgB,CAAC;AAE3C,MAAM,OAAO,aAAa;IAKxB,gEAAgE;IAChE;QALQ,uBAAkB,GAAa,EAAE,CAAC;IAKnB,CAAC;IAExB,MAAM,CAAC,qBAAqB;QAC1B,KAAK,MAAM,CAAC,IAAI,CAAC,0BAA0B,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;QAChE,KAAK,MAAM,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;QAC5C,MAAM,QAAQ,GAAG,aAAa,CAAC,QAAQ,CAAC;QAExC,MAAM,UAAU,GAAG,SAAS,EAAE,CAAC;QAE/B,QAAQ,CAAC,kBAAkB,GAAG,CAAC,GAAG,QAAQ,CAAC,kBAAkB,EAAE,UAAU,CAAC,CAAC;QAE3E,OAAO,UAAU,CAAC;IACpB,CAAC;IAED,MAAM,CAAC,sBAAsB,CAAC,UAAkB;QAC9C,MAAM,QAAQ,GAAG,aAAa,CAAC,QAAQ,CAAC;QACxC;;WAEG;QACH,QAAQ,CAAC,kBAAkB,GAAG,QAAQ,CAAC,kBAAkB,CAAC,MAAM,CAC9D,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,KAAK,UAAU,CAC1B,CAAC;QAEF;;WAEG;QACH,IAAI,QAAQ,CAAC,kBAAkB,CAAC,MAAM,KAAK,CAAC,EAAE;YAC5C,KAAK,MAAM,CAAC,IAAI,CAAC,0BAA0B,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;YACjE,KAAK,MAAM,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;SAC9C;IACH,CAAC;IAEO,MAAM,KAAK,QAAQ;QACzB,IAAI,CAAC,aAAa,CAAC,SAAS,EAAE;YAC5B,aAAa,CAAC,SAAS,GAAG,IAAI,aAAa,EAAE,CAAC;SAC/C;QACD,OAAO,aAAa,CAAC,SAAS,CAAC;IACjC,CAAC;CACF","sourcesContent":["import bridge from '@vkontakte/vk-bridge';\nimport { createKey } from '../utils/utils';\n\nexport class BridgeService {\n  private swipeBackConsumers: string[] = [];\n\n  private static _instance: BridgeService | undefined;\n\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  private constructor() {}\n\n  static enableNativeSwipeBack(): string {\n    void bridge.send('VKWebAppSetSwipeSettings', { history: true });\n    void bridge.send('VKWebAppEnableSwipeBack');\n    const instance = BridgeService.instance;\n\n    const consumerId = createKey();\n\n    instance.swipeBackConsumers = [...instance.swipeBackConsumers, consumerId];\n\n    return consumerId;\n  }\n\n  static disableNativeSwipeBack(consumerId: string) {\n    const instance = BridgeService.instance;\n    /**\n     * Тот, кто попросил отключить нативный свайпбек, выходит из списка.\n     */\n    instance.swipeBackConsumers = instance.swipeBackConsumers.filter(\n      (id) => id !== consumerId,\n    );\n\n    /**\n     * Нативный свайпбек будет отключен только если больше не осталось тех, кому он нужен.\n     */\n    if (instance.swipeBackConsumers.length === 0) {\n      void bridge.send('VKWebAppSetSwipeSettings', { history: false });\n      void bridge.send('VKWebAppDisableSwipeBack');\n    }\n  }\n\n  private static get instance(): BridgeService {\n    if (!BridgeService._instance) {\n      BridgeService._instance = new BridgeService();\n    }\n    return BridgeService._instance;\n  }\n}\n"]}